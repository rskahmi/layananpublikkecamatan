@extends('layout.user')

@section('headers')
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">

    <style>
        .tree ul {
            padding-top: 20px;
            position: relative;
            left: -15px;
            transition: all 0.5s;
            -webkit-transition: all 0.5s;
            -moz-transition: all 0.5s;
        }

        .tree ul ul ul::before {
            content: '';
            position: absolute;
            left: 57.5%;
            bottom: -20px;
            border-left: 2px solid rgba(0, 0, 0, .45);
            height: 20px;
        }

        .tree li {
            float: left;
            text-align: center;
            list-style-type: none;
            position: relative;
            padding: 20px 5px 0 5px;
            transition: all 0.5s;
            -webkit-transition: all 0.5s;
            -moz-transition: all 0.5s;
        }

        .tree li::before,
        .tree li::after {
            content: '';
            position: absolute;
            top: 0;
            right: 30%;
            border-top: 2px solid rgba(0, 0, 0, .45);
            width: 55%;
            height: 20px;
        }

        .tree li::after {
            right: auto;
            left: 60%;
            border-left: 2px solid rgba(0, 0, 0, .45);
        }

        .tree li:only-child::after,
        .tree li:only-child::before {
            display: none;
        }

        .tree li:only-child {
            padding-top: 0;
        }

        .tree li:first-child::before,
        .tree li:last-child::after {
            border: 0 none;
        }

        .tree li:last-child::before {
            border-right: 2px solid rgba(0, 0, 0, .45);
            border-radius: 0 5px 0 0;
            -webkit-border-radius: 0 5px 0 0;
            -moz-border-radius: 0 5px 0 0;
        }

        .tree li:first-child::after {
            border-radius: 5px 0 0 0;
            -webkit-border-radius: 5px 0 0 0;
            -moz-border-radius: 5px 0 0 0;
        }

        .tree ul ul::before {
            content: '';
            position: absolute;
            top: 0;
            left: 54%;
            border-left: 2px solid rgba(0, 0, 0, .45);
            width: 0;
            height: 20px;
        }

        .tree li a {
            text-decoration: none;
            color: #666;
            font-family: arial, verdana, tahoma;
            font-size: 11px;
            display: inline-block;
            border-radius: 5px;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            transition: all 0.5s;
            -webkit-transition: all 0.5s;
            -moz-transition: all 0.5s;
        }

        .struktur img {
            width: 120px;
            height: 122px;
            border-radius: 5px 5px 0px 0px;
            object-fit: cover;
        }

        .struktur a img {
            border-top: .25px solid #145ea8;
            border-left: .25px solid #145ea8;
            border-right: .25px solid #145ea8;
        }

        ul ul li a {
            margin-left: 30px;
        }

        ul ul ul li a {
            margin-left: 65px;
        }
    </style>
@endsection

@section('bodyClass', 'profil-perusahaan-body')
@section('title', 'Profile Perusahaan')
@section('content')

    <x-svg.fitur.tjsl />
    <div class="row">
        <div class="col-12 mb-3">
            <div class="card customize">
                <div class="card-header d-flex justify-content-end">
                    <a href="#edit-kontak" class="btn-edit" data-bs-toggle="modal" data-bs-target="#editKontak">
                        <x-svg.icon.editGray />
                        Edit
                    </a>
                </div>
                <div class="card-body">
                    <div class="row ps-3 pe-3">
                        <div class="col-12 col-xl-5">
                            <img src="{{ asset('assets/img/logo/logo-kpi-ru-dumai-ii.png') }}" width="137" height="67"
                                alt="Logo Kilang Pertamina Internasional Refenery Unit II">
                            <h2 class="sub-header">PT Kilang Pertamina Internasional Refinery Unit II Dumai</h2>
                            <table class="deleted-space">
                                <tr>
                                    <td>Telepon</td>
                                    <td>:</td>
                                    <td>{{ $telepon->deskripsi }}</td>
                                </tr>
                                <tr>
                                    <td>Email</td>
                                    <td>:</td>
                                    <td>{{ $email->deskripsi }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-12 col-xl-7">
                            <iframe
                                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3988.113319707888!2d101.46012227581573!3d1.675092560442365!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31d3afbb4a5629bd%3A0xae240cba8d3456e9!2sComrel%20%26%20CSR%20PT%20Kilang%20Pertamina%20Internasional%20RU%202%20Dumai!5e0!3m2!1sen!2sid!4v1713746587332!5m2!1sen!2sid"
                                width="100%" height="191" style="border:0;" allowfullscreen="" loading="lazy"
                                referrerpolicy="no-referrer-when-downgrade"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12">
            <div class="row">
                <div class="col-12 col-xl-7 mb-3 mb-xl-0">
                    <div class="card customize visimisi">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-6">
                                    <h5 class="card-title">Visi & Misi</h5>
                                </div>
                                <div class="col-6 card-header d-flex justify-content-end">
                                    <a href="#edit-visi-misi" class="btn-edit" data-bs-toggle="modal"
                                        data-bs-target="#editVisiMisi">
                                        <x-svg.icon.editGray />
                                        Edit
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="w-75">
                                <p class="mt-3" style="line-height: 1.5;">
                                    <b>Visi</b>: <br> {{ $visi->deskripsi }}
                                </p>
                                <p class="mt-3" style="line-height: 1.5;">
                                    <b>Misi</b>: <br> {{ $misi->deskripsi }}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-xl-5">
                    <div class="card customize sekilas-ru-ii">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-6">
                                    <h5 class="card-title">Sekilas Pertamina RU II</h5>
                                </div>
                                <div class="col-6 card-header d-flex justify-content-end">
                                    <a href="#edit-kontak" class="btn-edit" data-bs-toggle="modal"
                                        data-bs-target="#editSekilas">
                                        <x-svg.icon.editGray />
                                        Edit
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <img src="{{ isFileExists('storage/images/profil-perusahaan/sekilas/' . $sekilas->gambar, asset('assets/img/dafault/default-bg.png')) }}"
                                alt="Gambar sekilas" width="631" height="239" class="rounded">
                            <div class="deskripsi">
                                <div class="limited-text-deskripsi-sekilas">
                                    {!! limitCharacters($sekilas->deskripsi, 290) !!}
                                </div>
                                @if (isLimit($sekilas->deskripsi, 290))
                                    <div class="full-text-deskripsi-sekilas" style="display: none;">
                                        {!! $sekilas->deskripsi !!}
                                    </div>
                                @endif
                                @if (isLimit($sekilas->deskripsi, 290))
                                    <div class="text-center">
                                        <a class="btn-more-less" href="#show-more" id="showMoreSekilas">Show More</a>
                                    </div>
                                @endif
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 mt-3">
            <div class="row">
                <div class="col-12 col-xl-7 mb-3 mb-xl-0">
                    <div class="card customize">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-6">
                                    <h5 class="card-title">Struktur Organisasi
                                        Comm, Rel & CSR RU II</h5>
                                </div>
                                <div class="col-6 card-header d-flex justify-content-end">
                                    <a href="#edit-struktur" class="btn-edit" data-bs-toggle="modal"
                                        data-bs-target="#editStruktur">
                                        <x-svg.icon.editGray />
                                        Edit
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="struktur d-flex align-items-center justify-content-center">
                                <div class="tree">
                                    <ul>
                                        <li>
                                            <a href="#">
                                                <img src="{{ asset('storage/images/profil-perusahaan/struktur/' . $jabatanTingkat1->gambar) }}"
                                                    alt="Gambar {{ $jabatanTingkat1->deskripsi }}">
                                                <div class="identitas text-center">
                                                    {{ $jabatanTingkat1->deskripsi }}
                                                    <div class="jabatan">
                                                        {{ $jabatanTingkat1->jabatan }}
                                                    </div>
                                                </div>
                                            </a>
                                            <ul>
                                                <li>
                                                    <a href="#">
                                                        <img src="{{ asset('storage/images/profil-perusahaan/struktur/' . $jabatanTingkat2->gambar) }}"
                                                            alt="Gambar {{ $jabatanTingkat2->deskripsi }}">
                                                        <div class="identitas text-center">
                                                            {{ $jabatanTingkat2->deskripsi }}
                                                            <div class="jabatan">
                                                                {{ $jabatanTingkat2->jabatan }}
                                                            </div>
                                                        </div>
                                                    </a>
                                                    <ul>
                                                        <li><a href="#">
                                                                <img src="{{ asset('storage/images/profil-perusahaan/struktur/' . $jabatanTingkat3->gambar) }}"
                                                                    alt="Gambar {{ $jabatanTingkat3->deskripsi }}">
                                                                <div class="identitas text-center">
                                                                    {{ $jabatanTingkat3->deskripsi }}
                                                                    <div class="jabatan">
                                                                        {{ $jabatanTingkat3->jabatan }}
                                                                    </div>
                                                                </div>
                                                            </a>
                                                        </li>
                                                        <li>
                                                            <a href="#">
                                                                <img src="{{ asset('storage/images/profil-perusahaan/struktur/' . $jabatanTingkat4->gambar) }}"
                                                                    alt="Gambar {{ $jabatanTingkat4->deskripsi }}">
                                                                <div class="identitas text-center">
                                                                    {{ $jabatanTingkat4->deskripsi }}
                                                                    <div class="jabatan">
                                                                        {{ $jabatanTingkat4->jabatan }}
                                                                    </div>
                                                                </div>
                                                            </a>

                                                        </li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-xl-5">
                    <div class="card customize sekilas-ru-ii">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-6">
                                    <h5 class="card-title">Sejarah Pertamina RU II</h5>
                                </div>
                                <div class="col-6 card-header d-flex justify-content-end">
                                    <a href="#edit-kontak" class="btn-edit" data-bs-toggle="modal"
                                        data-bs-target="#editSejarah">
                                        <x-svg.icon.editGray />
                                        Edit
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <img class="w-100"
                                src="{{ isFileExists('storage/images/profil-perusahaan/sejarah/' . $sejarah->gambar, asset('assets/img/dafault/default-bg.png')) }}"
                                alt="Gambar sejarah">
                            <div class="deskripsi">
                                <div class="limited-text-deskripsi-sejarah">
                                    {!! limitCharacters($sejarah->deskripsi, 290) !!}
                                </div>
                                @if (isLimit($sejarah->deskripsi, 290))
                                    <div class="full-text-deskripsi-sejarah" style="display: none;">
                                        {!! $sejarah->deskripsi !!}
                                    </div>
                                @endif
                                @if (isLimit($sejarah->deskripsi, 290))
                                    <div class="text-center">
                                        <a class="btn-more-less" href="#show-more" id="showMoreSejarah">Show More</a>
                                    </div>
                                @endif
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 mt-3">
            <div class="row">
                <div class="col-12 col-xl-7">
                    <div class="card customize visimisi">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-6">
                                    <h5 class="card-title">Produk Yang Dihasilkan</h5>
                                </div>
                                <div class="col-6 card-header d-flex justify-content-end gap-2">
                                    <button class="btn btn-primary text-capitalize" data-bs-toggle="modal"
                                        data-bs-target="#tambahProduk">
                                        <x-svg.icon.addfile />
                                        Tambah
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <x-table>
                                @slot('slotHeading')
                                    <tr>
                                        <th scope="col">NAMA</th>
                                        <th scope="col" class="text-center">KATEGORI</th>
                                        <th scope="col">GAMBAR</th>
                                        <th scope="col" class="text-center">ACTION</th>
                                    </tr>
                                @endslot

                                @slot('slotBody')
                                    @foreach ($produk as $item)
                                        <tr>
                                            <td>{{ $item->deskripsi }}</td>
                                            <td class="text-center text-uppercase">{{ $item->kategori }}</td>
                                            <td>
                                                <img width="144" height="52"
                                                    src="{{ isFileExists('storage/images/profil-perusahaan/produk/' . $item->gambar, asset('assets/img/dafault/default-bg.png')) }}"
                                                    alt="{{ $item->kategori }}">
                                            </td>
                                            <td>
                                                <div class="aksi">
                                                    <a href="##edit"
                                                    onclick="modalEditProduk(
                                                    '{{ route('profile.update.produk', ['id' => $item->id]) }}',
                                                    '{{ $item->deskripsi }}',
                                                    '{{ $item->kategori }}')">
                                                        <x-svg.icon.edit />
                                                    </a>

                                                    <x-layout.delete
                                                        action="{{ route('profile.delete.produk', $item->id) }}" />
                                                </div>
                                            </td>
                                        </tr>
                                    @endforeach
                                @endslot
                            </x-table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {{-- Edit Kontak profil --}}
    <x-modals.admin action="{{ route('profile.update.kontak') }}" id="editKontak" isUpdate=true>
        @slot('slotHeader')
            <h5 class="modal-title" id="exampleModalLabel">Edit Kontak</h5>
        @endslot

        @slot('slotBody')
            <div class="mb-3">
                <x-forms.input label="Telepon" name="telepon" placeholder="Masukkan Nomor Telepon"
                    value="{{ $telepon->deskripsi }}" />
            </div>
            <div class="mb-3">
                <x-forms.input label="Email" name="email" type="email" placeholder="Masukkan Email"
                    value="{{ $email->deskripsi }}" />
            </div>
        @endslot

        @slot('slotFooter')
            <button type="submit" class="btn btn-primary btn-tutup-modal">Simpan</button>
        @endslot
    </x-modals.admin>

    <x-modals.admin action="{{ route('profile.update.visi-misi') }}" id="editVisiMisi" isUpdate=true>
        @slot('slotHeader')
            <h5 class="modal-title" id="exampleModalLabel">Edit Visi & Misi</h5>
        @endslot

        @slot('slotBody')
            <div class="mb-3">
                <x-forms.textarea label="Visi" name="visi" placeholder="Masukkan Visi Perusahaan"
                    value="{{ $visi->deskripsi }}" />
            </div>
            <div class="mb-3">
                <x-forms.textarea label="Misi" name="misi" placeholder="Masukkan Misi Perusahaan"
                    value="{{ $misi->deskripsi }}" />
            </div>
        @endslot

        @slot('slotFooter')
            <button type="submit" class="btn btn-primary btn-tutup-modal">Simpan</button>
        @endslot
    </x-modals.admin>

    <x-modals.admin action="{{ route('profile.update.sekilas') }}" id="editSekilas" isUpdate=true>
        @slot('slotHeader')
            <h5 class="modal-title" id="exampleModalLabel">Edit Sekilas</h5>
        @endslot

        @slot('slotBody')
            <div class="mb-3">
                <x-forms.file name="gambarSekilas" label="Gambar Baru" placeholder="Upload Gambar" isRequired=0 />
            </div>

            <div class="mb-3">
                <x-forms.textarea name="deskripsiSekilas" label="Deskripsi" placeholder="Masukkan deskripsi media" />
            </div>
        @endslot

        @slot('slotFooter')
            <button type="submit" class="btn btn-primary btn-tutup-modal">Simpan</button>
        @endslot
    </x-modals.admin>

    <x-modals.admin action="{{ route('profile.update.sejarah') }}" id="editSejarah" isUpdate=true>
        @slot('slotHeader')
            <h5 class="modal-title" id="exampleModalLabel">Edit Sejarah</h5>
        @endslot

        @slot('slotBody')
            <div class="mb-3">
                <x-forms.file name="gambarSejarah" label="Gambar Baru" placeholder="Upload Gambar" isRequired=0 />
            </div>

            <div class="mb-3">
                <x-forms.textarea name="deskripsiSejarah" label="Deskripsi" placeholder="Masukkan deskripsi media" />
            </div>
        @endslot

        @slot('slotFooter')
            <button type="submit" class="btn btn-primary btn-tutup-modal">Simpan</button>
        @endslot
    </x-modals.admin>

    <x-modals.admin action="{{ route('profile.update.struktur') }}" id="editStruktur" isUpdate=true>
        @slot('slotHeader')
            <h5 class="modal-title" id="exampleModalLabel">Ubah Struktur</h5>
        @endslot

        @slot('slotBody')
            <div class="mb-3">
                <x-forms.select label="Tingkatan jabatan" name="tingkatan" placeholder="Pilih tingkatan ex: 1 For GM">
                    <option value="1">#1 General Manager</option>
                    <option value="2">#2 Area Manager Comm, Rel & CSR</option>
                    <option value="3">#3 Sr Officer 1 Comm, Rel</option>
                    <option value="4">#4 Jr Officer 1 CSR</option>
                    </x-forms.select2>
            </div>
            <div class="mb-3">
                <x-forms.input label="Nama" name="namaPejabat" placeholder="Masukkan nama" />
            </div>
            <div class="mb-3">
                <x-forms.input label="Jabatan" name="jabatan" placeholder="Masukkan jabatan" />
            </div>
            <div class="mb-3">
                <x-forms.file name="foto" label="Foto" placeholder="Upload foto" isRequired=0 />
            </div>
        @endslot

        @slot('slotFooter')
            <button type="submit" class="btn btn-primary btn-tutup-modal">Simpan</button>
        @endslot
    </x-modals.admin>

    <x-modals.admin action="{{ route('profile.store.produk') }}" id="tambahProduk">
        @slot('slotHeader')
            <h5 class="modal-title" id="exampleModalLabel">Tambah Produk</h5>
        @endslot

        @slot('slotBody')
            <div class="mb-3">
                <x-forms.input label="Nama produk" name="nama" placeholder="Masukkan Nama Produk" />
            </div>
            <div class="mb-3">
                <x-forms.file name="gambarProduk" label="Gambar Produk" placeholder="Upload Gambar" />
            </div>

            <div class="mb-3">
                <x-forms.select label="Kategori" name="kategori" placeholder="Masukkan Jenis Program">
                    <option value="BBM">BBM</option>
                    <option value="NON BBM">NON BBM</option>
                    </x-forms.select2>
            </div>
        @endslot

        @slot('slotFooter')
            <button type="submit" class="btn btn-primary btn-tutup-modal">Simpan</button>
        @endslot
    </x-modals.admin>

    <x-modals.admin action="{{ route('profile') }}" id="editProduk" isUpdate=true>
        @slot('slotHeader')
            <h5 class="modal-title" id="exampleModalLabel">Edit Produk</h5>
        @endslot

        @slot('slotBody')
            <div class="mb-3">
                <x-forms.input label="Nama produk" name="edtNama" placeholder="Masukkan Nama Produk" />
            </div>
            <div class="mb-3">
                <x-forms.file name="edtGambarProduk" label="Gambar Produk" placeholder="Upload Gambar" isRequired=0 />
            </div>

            <div class="mb-3">
                <x-forms.select label="Kategori" name="edtKategori" placeholder="Masukkan Jenis Program">
                    <option value="BBM">BBM</option>
                    <option value="NON BBM">NON BBM</option>
                    </x-forms.select2>
            </div>
        @endslot

        @slot('slotFooter')
            <button type="submit" class="btn btn-primary btn-tutup-modal">Simpan</button>
        @endslot
    </x-modals.admin>
@endsection

@section('scripts')
    <script>
        const dataSejarah = {!! json_encode($sejarah->deskripsi) !!}
        const dataSekilas = {!! json_encode($sekilas->deskripsi) !!}
        const jabatanTingkat1 = {!! json_encode($jabatanTingkat1) !!}
        const jabatanTingkat2 = {!! json_encode($jabatanTingkat2) !!}
        const jabatanTingkat3 = {!! json_encode($jabatanTingkat3) !!}
        const jabatanTingkat4 = {!! json_encode($jabatanTingkat4) !!}

        gambarHandler('gambarSekilas')
        gambarHandler('foto')
        createEditor("#deskripsiSekilas", dataSekilas)

        gambarHandler('gambarSejarah')
        createEditor("#deskripsiSejarah", dataSejarah)

        gambarHandler('gambarProduk')
        gambarHandler('edtGambarProduk')

        $('#tingkatan').change(function() {
            var value = $(this).val()

            switch (value) {
                case '1':
                    $("#namaPejabat").val(jabatanTingkat1.deskripsi)
                    $("#jabatan").val(jabatanTingkat1.jabatan)
                    break;
                case '2':
                    $("#namaPejabat").val(jabatanTingkat2.deskripsi)
                    $("#jabatan").val(jabatanTingkat2.jabatan)
                    break;
                case '3':
                    $("#namaPejabat").val(jabatanTingkat3.deskripsi)
                    $("#jabatan").val(jabatanTingkat3.jabatan)
                    break;
                case '4':
                    $("#namaPejabat").val(jabatanTingkat4.deskripsi)
                    $("#jabatan").val(jabatanTingkat4.jabatan)
                    break;
            }
        })

        $("#showMoreSekilas, #showLessSekilas").click(function() {
            if ($(this).attr('id') === 'showMoreSekilas') {
                document.querySelector('.limited-text-deskripsi-sekilas').style.display = 'none';
                document.querySelector('.full-text-deskripsi-sekilas').style.display = 'block';

                $(this).attr('id', 'showLessSekilas');
                $(this).html('Show Less');
            } else {
                document.querySelector('.limited-text-deskripsi-sekilas').style.display = 'block';
                document.querySelector('.full-text-deskripsi-sekilas').style.display = 'none';

                $(this).attr('id', 'showMoreSekilas');
                $(this).html('Show More');
            }
        });
        $("#showMoreSejarah, #showLessSejarah").click(function() {
            if ($(this).attr('id') === 'showMoreSejarah') {
                document.querySelector('.limited-text-deskripsi-sejarah').style.display = 'none';
                document.querySelector('.full-text-deskripsi-sejarah').style.display = 'block';

                $(this).attr('id', 'showLessSejarah');
                $(this).html('Show Less');
            } else {
                document.querySelector('.limited-text-deskripsi-sejarah').style.display = 'block';
                document.querySelector('.full-text-deskripsi-sejarah').style.display = 'none';

                $(this).attr('id', 'showMoreSejarah');
                $(this).html('Show More');
            }
        });
    </script>
@endsection
